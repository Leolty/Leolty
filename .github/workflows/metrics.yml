name: Metrics

on:
  schedule: [{cron: "0 0 * * *"}]   # 每天 00:00 UTC 运行
  workflow_dispatch:               # 允许手动触发
  push: {branches: ["master", "main"]}

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write        # 允许向仓库写入生成的 SVG

    steps:
      #################################################
      # ① 综合仪表盘（Header / Activity / Community）
      #################################################
      - name: Core metrics
        uses: lowlighter/metrics@latest
        with:
          filename: github-metrics.svg
          token: ${{ secrets.METRICS_TOKEN }}

          # 基础区块
          base: header, activity, community, repositories, metadata

          # 插件
          plugin_followup: yes              # 最近 PR / Issue / 评论
          plugin_people: yes                # 社区互动（跟随 & 被跟随）

          # 时间 & 语言环境
          config_timezone: Asia/Shanghai

      #################################################
      # ② 语言统计（条形图 + 代码行数）
      #################################################
      - name: Languages
        uses: lowlighter/metrics@latest
        with:
          filename: github-langs.svg
          token: ${{ secrets.METRICS_TOKEN }}

          base: repositories
          plugin_languages: yes
          plugin_languages_ignored: html, css, ipynb
          plugin_languages_sections: most-used, recently-used
          plugin_languages_indepth: yes
          plugin_lines: yes                 # 代码行增减趋势

      #################################################
      # ③ 成就 & StarList
      #################################################
      - name: Achievements & Stars
        uses: lowlighter/metrics@latest
        with:
          filename: github-achievements.svg
          token: ${{ secrets.METRICS_TOKEN }}

          base: ""
          plugin_achievements: yes
          plugin_achievements_display: compact
          plugin_achievements_threshold: B
          plugin_starlists: yes             # 收藏夹式 Star 展示
          plugin_starlists_limit_repositories: 6
          plugin_starlists_limit_languages: 0
