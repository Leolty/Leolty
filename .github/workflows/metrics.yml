name: Metrics

on:
  schedule: [{cron: "0 0 * * *"}]   # 每日 00:00 UTC 运行
  workflow_dispatch:               # 允许手动触发

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      # ---- ① 主页综合图 ----------------------------------------------------
      - name: Core metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}

          base: header, activity, community, repositories
          config_timezone: America/Los_Angeles

          plugin_isocalendar: yes

          filename: metrics.svg

      # ---- ② 语言统计图 ----------------------------------------------------
      - name: Languages metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}

          base: ""
          plugin_languages: yes
          languages_sections: most-used, recently-used, recently-updated
          languages_limit: 8
          languages_threshold: 0%
          config_twemoji: yes

          filename: metrics.languages.svg

      # ---- ③ 开发习惯图 ----------------------------------------------------
      - name: Habits metrics
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.METRICS_TOKEN }}

          base: ""
          plugin_habits: yes
          habits_facts: yes      # 统计习惯概览
          habits_trim: yes       # 去掉空白行，让图更紧凑
          config_timezone: America/Los_Angeles

          filename: metrics.habits.svg
